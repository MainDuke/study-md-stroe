~~~
~~~
주제 : 메시지 큐 Massge Que

웹 시스템 구축을 하는 관점에서, 확장성 있는 웹 시스템을 구축하고 나면 시스템 간의 차별화 되는 점이 그 사이트가 얼마나 잘 버티는지가 아니라
사용자의 입력이 얼마나 빨리 처리되고 반영되냐가 될 것이다.
어떤 서비스들은 거의 실시간으로 입력이 반영되는데 반해 어떤 시스템은 많은 기능 등으로 인해 속도가 느린 시스템도 있을 것이다. 문제의 키포인트느 입력을 그때그때 실시간으로 웹사이트에서
보이도록하는 Publishing 하는 것이 아니라 메시징으로 해결하는 것이다.

많은 최신 웹 앱 들이 가지고 있는 문제점은 모든 것을 환꺼번에 하나의 코드에서 처리하고 사용자에게 피드백을 주려고 한다는 거이다. 
그것은 유저 인터페이스를 만듦에 있어서, 같은 UI모듈(또는 라이브러리)에서 보여지는 것은 한꺼번에 처리하는 것이 구현하기 쉽기 떄문이다.

누군가가 즐겨찾기를 저장하고 싶어한다면? 또는 메시지를 보내고 싶어 한다면? 물론 당신은 사용자가 만들어낸 콘텐츠(User Generated COntent)가 시스템이 지원하는 모든 태그, 수신인, 키워드, 알림채널에 반영 되기를 원할 것이다.

하지만, 그 콘텐츠를 생성한 사용자가 웹앱이 빨리 피드백을 주기를 하염없이 기다리고 있는데도, 정말 그것을 한꺼번에 해야할까? 브라우져에서 로딩 이미지가 돌아가는 것을 지켜보고있는 사용자에게 그 모든 작업들이 당장 처리되는 것이 중요할까?

별로 중요하지 않다. 서비스 사용자는 계속 무언가를 진행하기를 원한다.  작성한 콘텐츠가 시스템에 받아들어졌다고 확인하고, 자신이 보고 있는 화면에 당장 반영되기를 원한다. 이 사람에게 자신이 작성한 메시지가 지금 당장 친구의 메시지람에 나타나고 공개 타임라인에 반영되고, 태깅되거나 RSS나 Atom 피드 반영 되는것이 중요할까?

다시 말하지만, 중요하지 않다. 동시에 처리되는지 별로 신경쓰지도, 대부분의 사용자가 별로 감사해 하지도 않는다. 그 대신에 그 콘텐츠가 주위 사람들에게 퍼지면서 생길 소셜 파급효과를 생각해보자.

~~~
1. 콘텐츠를 생산하고 있는 사람을 행복하게 하려면, 그사람의 화면에서 피드백을 50-200(milliseconds) 안에 주어야한다. (즉, 최악의 경우에도 0.5초안에 피드백이 와야 한다는 것이다.)
2. 다음으로 만족시켜야 할 사람은 콘텐츠를 생산한 사람을 팔로우하고 있는 사람이다. 그에게는 수만 ms 정도는 용납이 가능하다.(즉, 최악의 경우에도 10초안에 피드백이 와야 한다는 것이다.)
3. 마지막으로 콘텐츠 생산자와 전혀 상관없는 대중에게 보여지는 Tag페이지라던지, 키워드 페이지, 그리고 다른 공개된 페이지에 대해서 신경쓸 차례다. 이곳에는 수십만 ms정도 반영이 늦어져도 괜찮다. ( 즉, 최악의 경우에도 1~2분안에는 적용되어야한다는 것이다.)
~~~

여기서 말하고자 하는 것은 소셜 시스템 구조는 확장성이 있어야 하는 동시에, 사용자들이 즐겁게 사용할 수 있어야한다는 것이다. 이런 시간의 딜레이(delay) 에도 불구하고, 이런 시스템이 메신저나 이메일보다 콘텐츠 생산자들이 다른이들에게 메시지를 전달하는데 효과적이다. 물론 그것은 대부분의 작업이 수초 이내에 처리된다는 전제하에 말이다.

어떻게 이런 시스템을 만들 수 있을까? Queue를 사용하는 것이다. 물론 콘텐츠를 작성하고 완료버튼을 누르자마자 사용자의 DB에 저장하는 것은 바로 처리되어야한다. 그리고나서 그 이후의 일은 Queue에 넣고 그 하나의 작업이 여러 작업들을 또 Queue에 넣거나 분산처리가 필요한 작업들을 처리하도록 하는 것이다.

그 동안 콘텐츠를 작성한 사용자는 작업이 처리된데에 만족하고 다른 일을 할 것이다. 어쩌면 그 일이 새로운 콘텐츠를 계속 빠르게 작성하는 일일 수도 있다. 시스템이 빠르게 반응하기 때문에 가능한 일이다.

웹 기반의 콘텐츠 작성 인터페이스의 진정한 목적이 바로 그것이다. 사용자들의 입력을 빠르게 처리해서 다른것을 또 입력하고 싶어 하도록 만드는 것 말이다. 작성하는 화면 외에 정보를 시스템에서 읽어오는 부분은 분산되어 있는 데이타를 가능하면 빠르게 읽어오도록 해야한다.

빠르게 정보를 읽어들이는 일은 또 다른 주제이다. Queue를 사용해서 처리한 것을 빠르게 불러오려면 시스템의 부하를 가져오는 SQL join 문을 통해서 불러오기 보다는, 이곳 저곳에 중복 되어 저장되어있는 정보를 간단한 쿼리로 읽어오는 것이 좋은 방법이다.

---
---

정의 : 메시지 큐 (Massage Queue) - in Windows System , Cannal
메시지 큐는 키보드나 마우스를 통해 발생하는 사용자의 입력을 메시지로 전달하는 윈도우즈 시스템에서 어떤 프로세스에 대한 메시지를 저장하기 위해 할당된 큐다.
메시지 큐는 윈도우즈 시스템의 모든 스레드에 존재한다. 사용자가 창에 대해 어떤 조작을 수행하면 해당 입력은 메시지로 전달되며 프로세스가 메시지 큐에서 해당 입력에 대응하는 메시지를 읽어서 처리한다. 예를 들어 사용자가 마우스를 움직이는 경우에 마우스 움직임을 의미하는 메시지인 WM_MOUSEMOVE 가 메시지 큐에 저장되며, 프로그램은 메시지 루프를 통해 이에 대응하는 처리를 한다. 메시지 큐의 존재는 프로세스가 사용자가 취한 행동을 사건으로 해석하여 사건에 대응하는 처리를 수행할 수 있게 한다

coment : 이 내용은 커널과 os 에서 메시지 큐 에 대한 정의이다.

---
---
메시지 큐 개념을 다시 잡아보고자 학습용도로 작성한 포스팅입니다. 출처는 http://zzong.net/post/3

메시지 지향 미들웨어(Message Oriented Middleware : MOM )은 비동기 메시지를 사용하는 다른 응용 프로그램 사이에서 데이터 송수신을 의미합니다. MOM을 구현한 시스템을 메시지 큐 (MessageQueue: MQ)라 합니다. 메시지 큐는 별도의 공정 작업을 연기할 수 있는 유연성을 제공하여 SOA(Service-Orientend Architecture)의 개발에 도움을 줄 수 있습니다.

프로그래밍에서 MQ는 프로세스 또는 프로그램 인스턴스가 데이터를 서로 교환할 때 사용 하는 방법 입니다. 이때 데이터를 교환 할 때 시스템이 관리하는 메시지 큐를 이용하는 것이 특징입니다.

이렇게 서로 다른 프로세스나 프로그램 사이에 메시지를 교환 할 때 AMQP(Advanced Message Queuing Protocol)을 이용합니다. AMQP는 메시지 지향 미들웨이를 위한 open standard application layer protocol 입니다. AMQP를 이용하면 다른 벤더 사이에 메세지를 전송하는 것이 가능한데 JMS(Java Message Service)가 API를 제공하는 것과 달리 AMQP는 wire-protocol 을 제공하는데 이는 octet Stream을 이용해서 다른 네트워크 사이에 데이터를 전송할 수 있는 포맷으로 이를 사용하게 됩니다.

-메시지 큐의 장점
--비동기(Asynchronous):Queue에 넣기 때문에 나중에 처리할 수 있습니다.
--비동조(Decoupling):애플리케이션과 분리할 수 있습니다.
--탄력성(Resilience):일부가 실패시 전체에 영향을 받지 않습니다.
--과잉(Redundancy):실패할 경우 재실행 가능합니다.
--보증(Guarantees):작업이 처리된걸 확인할 수 있습니다.
--확장성(Scalable):다수의 프로세스들이 큐에 메시지를 보낼 수 있습니다.
